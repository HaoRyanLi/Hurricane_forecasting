training new model, the num of training epochs is 5
The num of num_steps_per_level 29
The num of num_steps_per_epoch 290
the shape of batch_data: (14, 384, 512, 6)
the shape of batch_data after transformation (10, 5, 384, 512, 6)
The shape of input: (10, 384, 512, 6)
  0%|                                                                                                                                                                    | 0/5 [00:00<?, ?it/s]
The shape of input: (10, 384, 512, 6)
the shape of batch_data: (14, 384, 512, 6)
  0%|                                                                                                                                                                    | 0/5 [03:02<?, ?it/s]
Traceback (most recent call last):
  File "/work/09012/haoli1/ls6/hurricane/code/hurr_u_net_2d0.0.py", line 388, in <module>
    trainer.train_model(Train_data, Test_data, num_epochs=num_epochs)
  File "/work/09012/haoli1/ls6/hurricane/code/hurr_u_net_2d0.0.py", line 338, in train_model
    loss, loss_ml, loss_mc, self.state, self.main_rng = self.train_epoch(self.state, self.main_rng)
  File "/work/09012/haoli1/ls6/hurricane/code/hurr_u_net_2d0.0.py", line 251, in train_epoch
    loss, loss_ml, loss_mc, state, main_rng = lax.fori_loop(0, self.num_steps_per_epoch, train_step, (loss, loss_ml, loss_mc, state, main_rng))
  File "/work/09012/haoli1/ls6/JAX/lib/python3.9/site-packages/jax/_src/traceback_util.py", line 162, in reraise_with_filtered_traceback
    return fun(*args, **kwargs)
  File "/work/09012/haoli1/ls6/JAX/lib/python3.9/site-packages/jax/_src/lax/control_flow/loops.py", line 1691, in fori_loop
    (_, result), _ = scan(_fori_scan_body_fun(body_fun), (lower_, init_val),
  File "/work/09012/haoli1/ls6/JAX/lib/python3.9/site-packages/jax/_src/traceback_util.py", line 162, in reraise_with_filtered_traceback
    return fun(*args, **kwargs)
  File "/work/09012/haoli1/ls6/JAX/lib/python3.9/site-packages/jax/_src/lax/control_flow/loops.py", line 274, in scan
    out = scan_p.bind(*consts, *in_flat,
  File "/work/09012/haoli1/ls6/JAX/lib/python3.9/site-packages/jax/_src/lax/control_flow/loops.py", line 999, in scan_bind
    return core.AxisPrimitive.bind(scan_p, *args, **params)
  File "/work/09012/haoli1/ls6/JAX/lib/python3.9/site-packages/jax/core.py", line 2428, in bind
    return self.bind_with_trace(top_trace, args, params)
  File "/work/09012/haoli1/ls6/JAX/lib/python3.9/site-packages/jax/core.py", line 332, in bind_with_trace
    out = trace.process_primitive(self, map(trace.full_raise, args), params)
  File "/work/09012/haoli1/ls6/JAX/lib/python3.9/site-packages/jax/core.py", line 699, in process_primitive
    return primitive.impl(*tracers, **params)
  File "/work/09012/haoli1/ls6/JAX/lib/python3.9/site-packages/jax/_src/dispatch.py", line 115, in apply_primitive
    return compiled_fun(*args)
  File "/work/09012/haoli1/ls6/JAX/lib/python3.9/site-packages/jax/_src/dispatch.py", line 895, in _execute_compiled
    out_flat = compiled.execute(in_flat)
jax._src.traceback_util.UnfilteredStackTrace: jaxlib.xla_extension.XlaRuntimeError: RESOURCE_EXHAUSTED: Out of memory while trying to allocate 9648344688 bytes.
BufferAssignment OOM Debugging.
BufferAssignment stats:
             parameter allocation:   13.40GiB
              constant allocation:        41B
        maybe_live_out allocation:   81.31MiB
     preallocated temp allocation:    8.99GiB
                 total allocation:   22.46GiB
Peak buffers:
	Buffer 1:
		Size: 13.32GiB
		Entry Parameter Subshape: f32[10,303,384,512,6]
		==========================
	Buffer 2:
		Size: 484.38MiB
		XLA Label: copy
		Shape: f32[4,10,386,514,16]
		==========================
	Buffer 3:
		Size: 484.38MiB
		Operator: op_name="jit(scan)/jit(main)/while/body/jit(train_step)/broadcast_in_dim[shape=(4, 10, 386, 514, 16) broadcast_dimensions=()]" source_file="/work/09012/haoli1/ls6/hurricane/code/hurr_u_net_2d0.0.py" source_line=227
		XLA Label: fusion
		Shape: f32[4,10,386,514,16]
		==========================
	Buffer 4:
		Size: 244.39MiB
		XLA Label: copy
		Shape: f32[4,10,194,258,32]
		==========================
	Buffer 5:
		Size: 244.39MiB
		Operator: op_name="jit(scan)/jit(main)/while/body/jit(train_step)/broadcast_in_dim[shape=(4, 10, 194, 258, 32) broadcast_dimensions=()]" source_file="/work/09012/haoli1/ls6/hurricane/code/hurr_u_net_2d0.0.py" source_line=227
		XLA Label: fusion
		Shape: f32[4,10,194,258,32]
		==========================
	Buffer 6:
		Size: 242.19MiB
		XLA Label: copy
		Shape: f32[4,10,386,514,8]
		==========================
	Buffer 7:
		Size: 242.19MiB
		XLA Label: copy
		Shape: f32[4,10,386,514,8]
		==========================
	Buffer 8:
		Size: 242.19MiB
		Operator: op_name="jit(scan)/jit(main)/while/body/jit(train_step)/broadcast_in_dim[shape=(4, 10, 386, 514, 8) broadcast_dimensions=()]" source_file="/work/09012/haoli1/ls6/hurricane/code/hurr_u_net_2d0.0.py" source_line=227
		XLA Label: fusion
		Shape: f32[4,10,386,514,8]
		==========================
	Buffer 9:
		Size: 240.00MiB
		XLA Label: copy
		Shape: f32[4,10,384,512,8]
		==========================
	Buffer 10:
		Size: 240.00MiB
		XLA Label: copy
		Shape: f32[4,10,384,512,8]
		==========================
	Buffer 11:
		Size: 240.00MiB
		XLA Label: copy
		Shape: f32[4,10,384,512,8]
		==========================
	Buffer 12:
		Size: 240.00MiB
		XLA Label: copy
		Shape: f32[4,10,384,512,8]
		==========================
	Buffer 13:
		Size: 240.00MiB
		XLA Label: copy
		Shape: f32[4,10,384,512,8]
		==========================
	Buffer 14:
		Size: 240.00MiB
		XLA Label: copy
		Shape: f32[4,10,384,512,8]
		==========================
	Buffer 15:
		Size: 240.00MiB
		XLA Label: copy
		Shape: f32[4,10,384,512,8]
		==========================
The stack trace below excludes JAX-internal frames.
The preceding is the original exception that occurred, unmodified.
--------------------
The above exception was the direct cause of the following exception:
Traceback (most recent call last):
  File "/work/09012/haoli1/ls6/hurricane/code/hurr_u_net_2d0.0.py", line 388, in <module>
    trainer.train_model(Train_data, Test_data, num_epochs=num_epochs)
  File "/work/09012/haoli1/ls6/hurricane/code/hurr_u_net_2d0.0.py", line 338, in train_model
    loss, loss_ml, loss_mc, self.state, self.main_rng = self.train_epoch(self.state, self.main_rng)
  File "/work/09012/haoli1/ls6/hurricane/code/hurr_u_net_2d0.0.py", line 251, in train_epoch
    loss, loss_ml, loss_mc, state, main_rng = lax.fori_loop(0, self.num_steps_per_epoch, train_step, (loss, loss_ml, loss_mc, state, main_rng))
jaxlib.xla_extension.XlaRuntimeError: RESOURCE_EXHAUSTED: Out of memory while trying to allocate 9648344688 bytes.
BufferAssignment OOM Debugging.
BufferAssignment stats:
             parameter allocation:   13.40GiB
              constant allocation:        41B
        maybe_live_out allocation:   81.31MiB
     preallocated temp allocation:    8.99GiB
                 total allocation:   22.46GiB
Peak buffers:
	Buffer 1:
		Size: 13.32GiB
		Entry Parameter Subshape: f32[10,303,384,512,6]
		==========================
	Buffer 2:
		Size: 484.38MiB
		XLA Label: copy
		Shape: f32[4,10,386,514,16]
		==========================
	Buffer 3:
		Size: 484.38MiB
		Operator: op_name="jit(scan)/jit(main)/while/body/jit(train_step)/broadcast_in_dim[shape=(4, 10, 386, 514, 16) broadcast_dimensions=()]" source_file="/work/09012/haoli1/ls6/hurricane/code/hurr_u_net_2d0.0.py" source_line=227
		XLA Label: fusion
		Shape: f32[4,10,386,514,16]
		==========================
	Buffer 4:
		Size: 244.39MiB
		XLA Label: copy
		Shape: f32[4,10,194,258,32]
		==========================
	Buffer 5:
		Size: 244.39MiB
		Operator: op_name="jit(scan)/jit(main)/while/body/jit(train_step)/broadcast_in_dim[shape=(4, 10, 194, 258, 32) broadcast_dimensions=()]" source_file="/work/09012/haoli1/ls6/hurricane/code/hurr_u_net_2d0.0.py" source_line=227
		XLA Label: fusion
		Shape: f32[4,10,194,258,32]
		==========================
	Buffer 6:
		Size: 242.19MiB
		XLA Label: copy
		Shape: f32[4,10,386,514,8]
		==========================
	Buffer 7:
		Size: 242.19MiB
		XLA Label: copy
		Shape: f32[4,10,386,514,8]
		==========================
	Buffer 8:
		Size: 242.19MiB
		Operator: op_name="jit(scan)/jit(main)/while/body/jit(train_step)/broadcast_in_dim[shape=(4, 10, 386, 514, 8) broadcast_dimensions=()]" source_file="/work/09012/haoli1/ls6/hurricane/code/hurr_u_net_2d0.0.py" source_line=227
		XLA Label: fusion
		Shape: f32[4,10,386,514,8]
		==========================
	Buffer 9:
		Size: 240.00MiB
		XLA Label: copy
		Shape: f32[4,10,384,512,8]
		==========================
	Buffer 10:
		Size: 240.00MiB
		XLA Label: copy
		Shape: f32[4,10,384,512,8]
		==========================
	Buffer 11:
		Size: 240.00MiB
		XLA Label: copy
		Shape: f32[4,10,384,512,8]
		==========================
	Buffer 12:
		Size: 240.00MiB
		XLA Label: copy
		Shape: f32[4,10,384,512,8]
		==========================
	Buffer 13:
		Size: 240.00MiB
		XLA Label: copy
		Shape: f32[4,10,384,512,8]
		==========================
	Buffer 14:
		Size: 240.00MiB
		XLA Label: copy
		Shape: f32[4,10,384,512,8]
		==========================
	Buffer 15:
		Size: 240.00MiB
		XLA Label: copy
		Shape: f32[4,10,384,512,8]
		==========================